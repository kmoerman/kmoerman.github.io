<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pace Converter — km/h ⇄ min/km</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-6">
  <main class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-8">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-semibold">Pace Converter</h1>
    </header>

    <p class="text-sm text-gray-600 mb-4">Convert between <strong>km/h</strong> (speed) and <strong>min/km</strong> (pace). Enter a value in either field — the other updates automatically.</p>

    <form id="converter" class="grid gap-4 sm:grid-cols-2">
      <label class="flex flex-col">
        <span class="text-sm font-medium text-gray-700 mb-1">Speed (km/h)</span>
        <div class="relative">
          <input id="speed" inputmode="decimal" class="w-full rounded-lg border px-4 py-3 pr-28 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="e.g. 12.5" />
          <button type="button" id="copySpeed" class="absolute right-1 top-1/2 -translate-y-1/2 bg-indigo-50 text-indigo-600 px-3 py-1 rounded-md text-sm hover:bg-indigo-100">Copy</button>
        </div>
        <p class="text-xs text-gray-500 mt-1">Decimal number. Example: <em>10</em>, <em>12.5</em></p>
      </label>

      <label class="flex flex-col">
        <span class="text-sm font-medium text-gray-700 mb-1">Pace (min / km)</span>
        <div class="relative">
          <input id="pace" inputmode="numeric" class="w-full rounded-lg border px-4 py-3 pr-28 bg-white mono focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="e.g. 5:00 or 5.0" />
          <button type="button" id="copyPace" class="absolute right-1 top-1/2 -translate-y-1/2 bg-indigo-50 text-indigo-600 px-3 py-1 rounded-md text-sm hover:bg-indigo-100">Copy</button>
        </div>
        <p class="text-xs text-gray-500 mt-1">Use mm:ss (e.g. <em>4:30</em>) or decimal minutes (e.g. <em>4.5</em>).</p>
      </label>

      <div class="sm:col-span-2 flex gap-3 items-center mt-2">
        <button id="swap" type="button" class="px-4 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">Swap source</button>
        <button id="clear" type="button" class="px-4 py-2 bg-red-50 text-red-600 rounded-lg text-sm hover:bg-red-100">Clear</button>

        <div class="ml-auto text-right text-sm text-gray-500">
          <div>Last updated: <span id="updated">—</span></div>
        </div>
      </div>

      <fieldset class="sm:col-span-2 mt-3 border-t pt-4">
        <legend class="text-sm font-medium text-gray-700 mb-2">Quick presets</legend>
        <div class="flex gap-2 flex-wrap">
          <button type="button" data-pace="3:50" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">3:50</button>
          <button type="button" data-pace="4:00" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:00</button>
          <button type="button" data-pace="4:10" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:10</button>
          <button type="button" data-pace="4:20" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:20</button>
          <button type="button" data-pace="4:30" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:30</button>
          <button type="button" data-pace="4:40" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:40</button>
          <button type="button" data-pace="4:50" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">4:50</button>
          <button type="button" data-pace="5:00" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">5:00</button>       
          <button type="button" data-pace="5:10" class="preset btn px-3 py-1 rounded-lg bg-yellow-50 text-yellow-800 text-sm">5:10</button>       
        </div>
      </fieldset>
    </form>

    <section class="mt-8 border-t pt-6">
      <h2 class="text-lg font-semibold mb-2">Speed ↔ Pace Graph</h2>
      <canvas id="paceChart" height="200"></canvas>
    </section>

  </main>

  <script>
    const el = id => document.getElementById(id);
    const speedInput = el('speed');
    const paceInput = el('pace');
    const updated = el('updated');
    const swapBtn = el('swap');
    const clearBtn = el('clear');
    const copySpeed = el('copySpeed');
    const copyPace = el('copyPace');

    let lastSource = 'speed';

    function nowStamp(){ return new Date().toLocaleString(); }
    function formatMinutesDecimalToMMSS(minDec){ if (!isFinite(minDec) || minDec <= 0) return '—'; const totalSeconds = Math.round(minDec * 60); const mm = Math.floor(totalSeconds / 60); const ss = totalSeconds % 60; return mm + ':' + String(ss).padStart(2,'0'); }
    function parsePace(value){ if (!value) return NaN; value = value.trim(); if (value.includes(':')){ const parts = value.split(':').map(s => s.trim()); if (parts.length !== 2) return NaN; const mm = Number(parts[0]); const ss = Number(parts[1]); if (!isFinite(mm) || !isFinite(ss) || mm < 0 || ss < 0 || ss >= 60) return NaN; return mm + ss/60; } const v = Number(value); if (!isFinite(v) || v <= 0) return NaN; return v; }
    function parseSpeed(value){ if (!value) return NaN; const v = Number(value); if (!isFinite(v) || v <= 0) return NaN; return v; }
    function speedToPaceMinPerKm(kmh){ return 60 / kmh; }
    function paceToSpeedKmH(minPerKm){ return 60 / minPerKm; }

    // Chart setup
    const ctx = document.getElementById('paceChart').getContext('2d');

    const spMin =  9
    const spMax = 18
    const spDelta = 0.1
    const spTotal = Math.ceil((spMax - spMin)/spDelta) + 1
    const speeds = Array.from({length: spTotal}, (_,i) => spMin + i*spDelta);
    const paces = speeds.map(s => speedToPaceMinPerKm(s));
    const chart = new Chart(ctx, {
      type: 'scatter',
      data: {
        datasets: [
          {
            label: 'Speed-Pace Curve',
            data: speeds.map((s,i)=>({x:s, y:paces[i]})),
            showLine: true,
            borderColor: 'rgba(99,102,241,0.5)',
            backgroundColor: 'rgba(99,102,241,0.1)',
            tension: 0.3,
            pointRadius: 0
          },
          {
            label: 'Your Value',
            data: [],
            pointBackgroundColor: 'rgba(239,68,68,0.9)',
            pointRadius: 6
          }
        ]
      },
      options: {
        scales: {
          x: { title: { display: true, text: 'Speed (km/h)' }, min: spMin, max: spMax, ticks: { stepSize: 1 } },
          y: { title: { display: true, text: 'Pace (min/km)' }, reverse: false, ticks: { stepSize: spDelta, callback: v => formatMinutesDecimalToMMSS(v) } }
        },
        plugins: { legend: { display: false } }
      }
    });

    function updateChartPoint(speed){
      const pace = speedToPaceMinPerKm(speed);
      chart.data.datasets[1].data = [{x: speed, y: pace}];
      chart.update();
    }

    function updateFromSpeed(){
      const s = parseSpeed(speedInput.value);
      if (!isFinite(s)){
        chart.data.datasets[1].data = [];
        chart.update();
        return;
      }
      paceInput.value = formatMinutesDecimalToMMSS(speedToPaceMinPerKm(s));
      updated.textContent = nowStamp();
      updateChartPoint(s);
    }

    function updateFromPace(){
      const p = parsePace(paceInput.value);
      if (!isFinite(p)){
        chart.data.datasets[1].data = [];
        chart.update();
        return;
      }
      const s = paceToSpeedKmH(p);
      speedInput.value = s.toFixed(2);
      updated.textContent = nowStamp();
      updateChartPoint(s);
    }

    speedInput.addEventListener('input', () => { lastSource = 'speed'; updateFromSpeed(); });
    paceInput.addEventListener('input', () => { lastSource = 'pace'; updateFromPace(); });

    swapBtn.addEventListener('click', () => { if (lastSource === 'speed'){ lastSource = 'pace'; speedInput.blur(); paceInput.focus(); } else { lastSource = 'speed'; paceInput.blur(); speedInput.focus(); } });
    clearBtn.addEventListener('click', () => { speedInput.value = ''; paceInput.value = ''; updated.textContent = '—'; chart.data.datasets[1].data = []; chart.update(); lastSource = 'speed'; speedInput.focus(); });

    document.querySelectorAll('.preset').forEach(b => { b.addEventListener('click', () => { const pace = b.dataset.pace; paceInput.value = pace; lastSource = 'pace'; updateFromPace(); }); });

    async function copyText(text){ try { await navigator.clipboard.writeText(text); const btn = document.activeElement; btn && (btn.textContent = 'Copied'); setTimeout(() => { btn && (btn.textContent = 'Copy'); }, 900); } catch (e){ alert('Clipboard copy failed — please copy manually.'); } }
    copySpeed.addEventListener('click', () => { const s = parseSpeed(speedInput.value); if (!isFinite(s)) return alert('Enter a valid speed first'); copyText(s.toFixed(2)); });
    copyPace.addEventListener('click', () => { const p = parsePace(paceInput.value); if (!isFinite(p)) return alert('Enter a valid pace first'); copyText(formatMinutesDecimalToMMSS(p)); });

    speedInput.value = '12';
    updateFromSpeed();
  </script>
</body>
</html>
