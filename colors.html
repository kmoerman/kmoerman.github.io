<!DOCTYPE html>
<html>
<head>
    <title>Noordkaap</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
    <style type="text/css">
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
        
        a.flickr {
            display: block;
            width: 10em;
            padding: 0;
            border: 0;
            margin: 0.5em 0 0 0;
        }
        
        a.flickr img {
            display: block;
            width: 100%;
            padding: 0;
            margin: 0;
        }
        
        div.point.camp {
            display: block;
            width: 9px;
            height: 9px;
            border: 2px solid #ed64d2;
            border-radius: 50%;
            padding: 0;
            background: #fff;
            opacity: 0.8;
            box-sizing: border-box;
        }
        
        div.point.part {
            display: block;
            width: 5px;
            height: 5px;
            border: 2px solid #ed64d2;
            border-radius: 50%;
            padding: 0;
            background: #ed64d2;
            opacity: 0.8;
            box-sizing: border-box;
        }
        
        div.point.cape {
            display: block;
            width: 10px;
            height: 10px;
            border: 2px solid #ed64d2;
            border-radius: 50%;
            padding: 0;
            background: #ffee00;
            opacity: 0.8;
            box-sizing: border-box;
        }
        
        div.point.south {
          border-color: #ffee000;
        }
        
        div.point.south.part {
          background-color: #ffee00;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
    <script>

function mix (e) {
  document.querySelectorAll('.point-camp').forEach(n => n.setAttribute('style', `mix-blend-mode: ${e.target.value};`))
} 
        
const map = L.map('map').setView([59.9139, 10.7522], 5);

L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
            { detectRetina: true, attribution: '<br/>WhatsApp Klaas +32 474 75 69 30<br/>&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

function flickr (embed) {
  const img = (flickr.rgx_img.exec(embed || '') || [])[1];
  const lnk = (flickr.rgx_lnk.exec(embed || '') || [])[1];

  if (!lnk || !img)
    return '';

  return `<a class="flickr" href="${lnk}"><img src="${img}" /></a>`;
}
flickr.rgx_img = /<img src="([^"]+)/;
flickr.rgx_lnk = /href="([^"]+)/;

const point =
  { camp : L.divIcon({className: 'point camp', iconSize: [9,9]})
  , part : L.divIcon({className: 'point part', iconSize: [5,5]})
  , cape : L.divIcon({className: 'point cape', iconSize: [10,10]})
  , none : undefined
  }

const Pink   = '#ed64d2'
const Yellow = '#ffe000'

const style =
  { north: { classes: ['north'], color: Pink }
  , south: { classes: ['south'], color: Yellow }
  }

const camp   = point.circle

function track () {
  this.markers = []
  this.root    = this
  this.branches= []

  this.style   = style.north
  this.lines   = new lines (this.style.color)

  for (const typ in point)
    this[typ] = Object.assign(Object.create(this), {symbol: point[typ], root: this})
}

track.prototype.symbol = point.camp

track.prototype.mark = function (lat, lon, ...rest) {
  this.symbol && this.markers.push(marker(lat,lon,this.symbol, ...rest))
}

track.prototype.branch = function (f) {
  const branch = new track ()
  branch.lines.last = Object.assign({}, this.lines.last, {name:0})
  this.branches.push(branch)
  f(branch)
  return this.root
}

track.prototype.walk =
track.prototype.bike = function (lat,lon,...rest) {
  this.mark(lat,lon,...rest)
  this.lines.line(lat,lon)
  return this.root
}

track.prototype.boat = function (lat,lon,...rest) {
  this.mark(lat,lon,...rest)
  this.lines.dots(lat,lon)
  return this.root
}

track.prototype.legacy = function (...entries) {
  return entries.reduce((t, [lat,lon,,...rest]) => t.bike(lat,lon,...rest), this)
}

track.prototype.addTo = function (map) {
  this.markers.forEach(m => m.addTo(map))
  this.lines.addTo(map)
  this.branches.forEach(b => b.addTo(map))
  return this.root
}

track.prototype.northbound = function () {
  return Object.assign(new track (), this, {style: style.north, lines: this.lines.restyle(style.north.color)})
}

track.prototype.southbound = function () {
  return Object.assign(new track (), this, {style: style.south, lines: this.lines.restyle(style.south.color)})
}

function lines (color) {
  this.segments = []
  this.points   = []
  this.last     = {}
  this.style    = {color}
}


lines.style =
  { line: {weight:3, opacity: 0.8}
  , dots: {weight:3, opacity: 0.9, dashArray: '0 4'}
//  , dotsP:{color: Pink, weight:3, opacity: 0.9, dashArray: '0 8'}
//  , dotsY:{color: Pink, weight:3, opacity: 0.9, dashArray: '0 8'}
  }

Object.entries(lines.style).forEach(([name, style]) => 
  lines.prototype[name] = function (lat, lon) {
    if (this.last.name === undefined) {
      this.segments.push(new L.Polyline ([[lat, lon]], {...style, this.style}))
    } else {
      if (this.last.name !== name)
        this.segments.push(new L.Polyline ([[this.last.lat,this.last.lon]], {...style, this.style}))
    }
    
    this.segments.at(-1).addLatLng([lat,lon])
    
    this.last = {name,lat,lon}
  })

lines.prototype.restyle = function (color) {
  return Object.assign(new lines (color), this, {style:{color}})
}

lines.prototype.addTo = function (map) {
  this.segments.forEach(pl => pl.addTo(map))
}

function marker (lat, lon, icon, dat, msg, pic) {
  const m = new L.marker ([lat, lon], {icon});
  if (arguments.length <= 3)
    return m;
  
  m.bindPopup(`<b>${dat.replace(/\s..:../g, '')}</b>${msg ? '<br/>'+msg : ''}${flickr(pic)}`);
  return m;
}

// track
const T = new track ()

T//.northbound()
 .cape.bike(51.2406477,  2.9161213, 'za 13/5 14:00', '🇧🇪 Start', '<a class="flickr" href="https://www.flickr.com/photos/198383566@N06/52915039516/in/datetaken-public"><img src="https://live.staticflickr.com/65535/52915039516_a66e7b38e7_c.jpg" /></a>')
 .legacy
  ( [51.5762520,  3.6173393, camp, 'za 13/5 19:00', '🇳🇱']
  , [52.0935209,  5.1114410, camp, 'zo 14/5 19:50', 0, '<a class="flickr" href="https://www.flickr.com/photos/198383566@N06/52915194169/in/datetaken-public"><img src="https://live.staticflickr.com/65535/52915194169_0bf78ca542_c.jpg" /></a>']
  , [52.2855475,  6.4628477, camp, 'ma 15/5 18:45']
  , [52.6923229,  7.2843355, camp, 'di 16/5 17:30', '🇩🇪']
  , [53.0881179,  8.8082990, camp, 'wo 17/5 21:05']
  , [53.9402006, 10.8567684, camp, 'do 18/5 20:55']
  )
 .boat(55.6273423, 12.9901649, 'vr 19/5 07:00', '🇸🇪')
 .legacy
  ( [55.7463435, 12.5873856, camp, 'za 20/5 19:45', '🇩🇰']
  , [56.2663373, 12.8370822, camp, 'zo 21/5 20:00', '🇸🇪', '<a class="flickr" href="https://www.flickr.com/photos/198383566@N06/52915194264/in/datetaken-public"><img src="https://live.staticflickr.com/65535/52915194264_b346a69260_c.jpg" /></a>']
  , [57.0605297, 12.2744754, camp, 'ma 22/5 20:45']
  , [57.7900683, 11.8339524, camp, 'di 23/5 21:30', undefined, '<a class="flickr" href="https://www.flickr.com/photos/198383566@N06/52919963552/in/datetaken-public/"><img src="https://live.staticflickr.com/65535/52919963552_1015bd1960_c.jpg" /></a>']
  , [58.8468393, 11.5457702, camp, 'wo 24/5 23:20', undefined, '<a class="flickr" href="https://www.flickr.com/photos/198383566@N06/52924580969/in/datetaken-public/"><img src="https://live.staticflickr.com/65535/52924580969_87db42b008_c.jpg" /></a>']
  , [59.8987718, 10.7731690, camp, 'do 25/5 21:15<br/>vr 26/5', '🇳🇴', '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52932195648/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52932195648_5a1ee8990a_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">']
  , [60.0447897, 10.3841833, camp, 'za 27/5 20:10', undefined, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52930446575/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52930446575_5d6d338b8e_c.jpg" width="481" height="800" alt="Untitled"/></a>']
  , [60.2750742,  9.9705605, camp, 'zo 28/5 21:05']
  , [60.8831138,  9.4275872, camp, 'ma 29/5 22:30', undefined, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52935878524/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52935878524_f8768254a0_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">']
  , [61.6675408,  9.0327375, camp, 'di 30/5 21:30', '🏔️ Valdresflye', '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52938435001/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52938435001_e9952f99e9_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">']
  , [62.0953492,  7.2189268, camp, 'wo 31/5 23:20<br/>do 1/6', undefined, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52940740767/in/datetaken-public" title="Untitled"><img src="https://live.staticflickr.com/65535/52940740767_f69ce5bd4e_c.jpg" width="800" height="366" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"']
  , [62.7377522,  7.4521446, camp, 'vr 2/6 24:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52947631310/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52947631310_e9a492fe91_c.jpg" width="600" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"']
  , [63.2703583,  8.4956540, camp, 'za 3/6 21:00', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52947241086/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52947241086_f7587e9aab_c.jpg" width="600" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"']
  , [63.4329740, 10.3725049, camp, 'zo 4/6 20:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52952847086/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52952847086_f91ec27d4b_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8']
  , [63.5871109, 10.4224705, camp, 'ma 5/6 20:15']
  , [64.1080140, 11.3850700, camp, 'di 6/6 20:30']
  , [64.9844040, 11.7575759, camp, 'wo 7/6 23:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52957301422/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52957301422_225ef30db7_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8']
  , [65.8956720, 12.5362453, camp, 'do 8/6 21:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52962049820/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52962049820_db2c55e715_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"']
  )
 .part.bike(66.0242818, 12.6420085)
 .part.boat(66.3392418, 13.0026677)
 .bike(66.7438443, 13.5594980, 'vr 9/6 22:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52963174638/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52963174638_d0d0fba288_c.jpg" width="729" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf')
 .part.bike(67.2883011, 14.3941594, 'za 10/6 18:30',0,'<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52963896462/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52963896462_d22239b947_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .boat(67.8998519, 13.0438754, 'za 10/6 22:00<br/>zo 11/6<br />wo 28/6 23:45',0,'<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52963874712/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52963874712_b8455642e6_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .bike(68.3233079, 14.2025908, 'ma 12/6 22:00', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52969476407/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52969476407_b6268a1e1f_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8')
 .bike(68.8764104, 15.5666862, 'di 13/6 22:20', '🎂')
 .part.bike(69.3268050, 16.1335661)
 .part.boat(69.3633950, 17.0525026)
 .bike(69.6140502, 18.0906804, 'wo 14/6 21:00')
 .bike(69.6457804, 18.9506429, 'do 15/6 14:00', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52977204886/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52977204886_4a3b27564f_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .bike(69.6013013, 19.9515105, 'vr 16/6 20:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52978684927/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52978684927_ccaa88a783_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .bike(69.8403800, 21.8461334, 'za 17/6 23:00', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52981059602/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52981059602_cfbeca2836_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .bike(70.0670130, 23.5411856, 'zo 18/6 22:30')
 .bike(70.6384899, 25.3753230, 'ma 19/6 21:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52986396867/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52986396867_82f7014767_c.jpg" width="439" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .cape.bike(71.1709533, 25.7836599, 'di 20/6 21:00', '🦵🦵', '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52991019960/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52991019960_db66dcc661_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .branch(t => t.part.walk(71.1845720, 25.6742579, 'di 20/6 25:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52990560394/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52990560394_aa82d6d08d_c.jpg" width="800" height="441" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">'))
 //.southbound()
 .part.bike(70.9810860, 25.9685405, 'wo 21/6 06:00')
 .boat(70.6648820, 23.6817711, 'wo 21/6 11:00', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52990545414/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52990545414_f28ef500cc_c.jpg" width="600" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .branch(t => t.part.boat(70.7917866, 23.4138028)
               .bike(70.7905874, 23.3320504, 'do 22/6 20:30'))
 .part.boat(70.2385466, 22.3477377)
 .branch(t => t.bike(70.2381443, 22.1035863, 'vr 23/6 20:45', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52997795021/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52997795021_d04223252e_c.jpg" width="800" height="600" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
               .part.walk(70.2147456, 22.0880784))
 .boat(70.0351390, 20.9826800, 'za 24/6 19:30', 0, '<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/52998592268/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/52998592268_9e19ea4e32_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .bike(69.0913744, 19.6071665, 'zo 25/6 22:00')
 .part.bike(69.2290900, 17.9742809)
 .part.boat(68.8010655, 16.5467097)
 .bike(68.6899607, 16.0324551, 'ma 26/6 21:15')
 .bike(68.3551378, 14.4874424, 'di 27/6 21:10',0,'<a data-flickr-embed="true" href="https://www.flickr.com/photos/198383566@N06/53005736317/in/datetaken-public/" title="Untitled"><img src="https://live.staticflickr.com/65535/53005736317_19244078bb_c.jpg" width="800" height="800" alt="Untitled"/></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8">')
 .none.bike(67.8998519, 13.0438754) // (67.9067249, 13.0501485, 'wo 28/6 23:45')
 .addTo(map)


// arctic circle
const lat = 66.56375
const lon = 13.37
const delta = 0.5
const arctic = new L.Polyline([[lat, lon-delta],[lat,lon+delta]], {color: Pink, opacity: 0.9, weight: 1, dashArray: '8 4'})
                       .addTo(map);

// scale
L.control.scale({metric: true, imperial: false}).addTo(map);
    
    </script>
</body>
</html>
